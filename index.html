<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3姉妹のレストラン決定アプリ</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- PWA対応 -->
    <link rel="manifest" href="./manifest.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/apple-touch-icon-180.png?v=1">
    <link rel="apple-touch-icon" sizes="152x152" href="./icons/apple-touch-icon-152.png?v=1">
    <link rel="apple-touch-icon" sizes="167x167" href="./icons/apple-touch-icon-167.png?v=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="3姉妹投票">
    <meta name="theme-color" content="#ff6b6b">
    <meta name="description" content="3姉妹でレストランを楽しく決めるアプリ">
</head>
<body>
    <div class="container">
        <!-- 開始画面 -->
        <div id="welcome-screen" class="screen active">
            <h1>🍽️ 今日どこで食べる？ 🍽️</h1>
            <p class="subtitle" id="subtitle-text">3姉妹でレストランを決めよう！</p>
            <div class="button-group">
                <button class="start-btn">はじめる</button>
                <button class="settings-btn">⚙️ 設定</button>
            </div>
        </div>

        <!-- 設定画面 -->
        <div id="settings-screen" class="screen">
            <h2>⚙️ 設定</h2>
            <div class="settings-content">
                <div class="setting-item">
                    <label for="person-count">投票する人数:</label>
                    <select id="person-count" class="setting-select">
                        <option value="2">2人</option>
                        <option value="3" selected>3人</option>
                        <option value="4">4人</option>
                        <option value="5">5人</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="choice-count">一人あたりの投票数:</label>
                    <select id="choice-count" class="setting-select">
                        <option value="1">1個</option>
                        <option value="2">2個</option>
                        <option value="3" selected>3個</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="cheating-prevention">投票モード:</label>
                    <select id="cheating-prevention" class="setting-select">
                        <option value="flexible">柔軟モード（前の人に戻れる）</option>
                        <option value="strict" selected>厳格モード（カンニング禁止）</option>
                    </select>
                </div>
            </div>
            <div class="settings-buttons">
                <button class="save-settings-btn">保存</button>
                <button class="cancel-settings-btn">キャンセル</button>
            </div>
        </div>

        <!-- 投票画面 -->
        <div id="voting-screen" class="screen">
            <div class="sister-header">
                <div class="sister-avatar" id="current-avatar"></div>
                <h2 id="sister-name"></h2>
                <p class="instruction" id="instruction-text">食べたいお店を3つ書いてね！</p>
            </div>

            <div class="input-section" id="input-section">
                <!-- 入力フィールドは動的に生成される -->
            </div>

            <div class="voting-actions">
                <button class="prev-person-btn" id="prev-person-btn" style="display: none;">← 前の人</button>
                <button class="submit-btn">決定！</button>
                <button class="next-person-btn" id="next-person-btn" style="display: none;">次の人 →</button>
            </div>
        </div>

        <!-- 結果発表待機画面 -->
        <div id="ready-screen" class="screen">
            <div class="ready-container">
                <h2>🎉 みんなの投票が完了！ 🎉</h2>
                <p class="ready-message">準備はいい？</p>
                <button class="reveal-btn">結果発表！</button>
            </div>
        </div>

        <!-- 結果画面 -->
        <div id="result-screen" class="screen">
            <h2>みんなの選んだお店</h2>
            
            <div class="sisters-choices" id="sisters-choices">
                <!-- 結果表示は動的に生成される -->
            </div>

            <div class="winner-section">
                <h2>今日のお店は...</h2>
                <div id="winner-result"></div>
            </div>

            <button class="roulette-start-btn">ルーレットで決める！</button>
            <button class="restart-btn">もう一度</button>
        </div>

        <!-- ルーレット画面 -->
        <div id="roulette-screen" class="screen">
            <h2>🎰 運命のルーレット 🎰</h2>
            <div class="roulette-container">
                <div class="roulette-wheel" id="roulette-wheel">
                    <!-- ルーレットのセグメントが動的に追加される -->
                </div>
                <div class="roulette-pointer"></div>
            </div>
            <button class="spin-btn" id="spin-btn">ルーレット開始！</button>
            <div class="roulette-result" id="roulette-result" style="display: none;">
                <h3>今日のお店は決定！</h3>
                <div class="final-restaurant" id="final-restaurant"></div>
                <div class="roulette-actions">
                    <button class="restart-btn-roulette">もう一度最初から</button>
                </div>
            </div>
        </div>

        <!-- 全員一致の特別演出 -->
        <div id="celebration" style="display: none;">
            <div class="fireworks"></div>
            <div class="celebration-message">
                <h1>🎉 奇跡の全員一致！ 🎉</h1>
                <p id="unanimous-choice"></p>
            </div>
        </div>
        
        <!-- 部分一致の演出 -->
        <div id="partial-celebration" style="display: none;">
            <div class="stars"></div>
            <div class="partial-celebration-message">
                <h1>⭐ みんなの気持ちが重なった！ ⭐</h1>
                <p id="partial-match-choice"></p>
            </div>
        </div>
        
        <!-- タグ一致の演出 -->
        <div id="tag-celebration" style="display: none;">
            <div class="tag-bubbles"></div>
            <div class="tag-celebration-message">
                <h1>🏷️ 好みが似てる！ 🏷️</h1>
                <p id="tag-match-info"></p>
            </div>
        </div>
    </div>

    <!-- 紙吹雪エフェクト用 -->
    <canvas id="confetti-canvas"></canvas>

    <script src="restaurants-db.js"></script>
    <script src="sound-effects.js"></script>
    <script src="app.js"></script>
    
    <!-- Service Worker登録 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker登録成功:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker登録失敗:', error);
                    });
            });
        }
    </script>
</body>
</html>